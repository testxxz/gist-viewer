<!DOCTYPE HTML>
<html>
<head>
<title>Gist Viewer</title>
</head>
<body>
  <h1>Gist Viewer</h1>
  <h4>Displays the Gist of your choice, assuming it’s in standard style.css + index.html + script.js format</h4>
  <label>Gist URL: <input></input></label>
  <button>Go</button>
  <link id="style" rel="stylesheet">
  <div id="index"></div>
  <script id="script"></script>
  <script>{
    const
      d = document,
      $ = d.querySelector.bind(d),
      $input = $('input'),
      $button = $('button'),
      $style = $('#style'),
      $index = $('#index'),
      $script = $('#script'),
      validGistUrl = /^https:\/\/gist\.github\.com\/[-0-9a-z]+\/([0-9a-f]+)$/

    // Fetch Gist metadata with a ‘Go’ button click.
    $button.addEventListener('click', onGo)
    function onGo () {
      const gistId = ($input.value.match(validGistUrl) || [])[1]
      if (! gistId) return alert('Not a valid Gist URL!')
      fetch(`https://api.github.com/gists/${gistId}`)
        .then(function(response) {
          return response.json()
        })
        .then(updateFiles)
    }
      
    // Update style.css + index.html + script.js.
    function updateFiles (gistMeta) {
      if (! gistMeta) return alert('No Gist meta!')
      if (! gistMeta.files) return alert('No Gist files meta!')
      if (! gistMeta.files['style.css']) return alert('The Gist has no ‘style.css’ file!')
      if (! gistMeta.files['index.html']) return alert('The Gist has no ‘index.html’ file!')
      if (! gistMeta.files['script.js']) return alert('The Gist has no ‘script.js’ file!')
      $style.href = gistMeta.files['style.css']
        .raw_url.replace('https://gist.githubusercontent.com/','https://cdn.rawgit.com/')
      fetch( gistMeta.files['index.html'].raw_url') )
        .then(function(response) {
          $index.innerHTML = response
          console.log(response)
          $script.src = gistMeta.files['script.js'].raw_url
            .replace('https://gist.githubusercontent.com/','https://cdn.rawgit.com/')
        })
    }
  }</script>
</body>
</html>
